<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tournaments | Esportive</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Zalando+Sans+Expanded:ital,wght@0,200..900;1,200..900&display=swap"
    rel="stylesheet"
  />
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
  />
  <style>
    body {
      font-family: "Zalando Sans Expanded", sans-serif;
      background: linear-gradient(135deg, #0f0f0f 0%, #000000 100%);
    }

    /* Sidebar hidden by default */
    #sidebar {
      transform: translateX(-100%);
      transition: transform 0.3s ease-in-out;
      width: 75%; /* mobile width */
      max-width: 300px;
    }

    /* When open */
    #sidebar.open {
      transform: translateX(0);
    }
  </style>
</head>
<body class="flex flex-col min-h-screen">
  <!-- Header -->
  <header
    class="fixed top-0 left-0 right-0 z-50 bg-black text-white px-4 py-6 lg:py-8 flex items-center justify-between"
  >
    <div class="flex items-center">
      <button id="menu-toggle" class="text-xl text-white focus:outline-none">
        <i id="menu-icon" class="fas fa-bars transition-transform duration-300"></i>
      </button>
    </div>
    <div class="flex-grow flex justify-center">
      <img
        src="../assets/navbar/logo.png"
        alt="Esportive Logo"
        class="h-8 lg:h-10"
      />
    </div>
    <div class="flex items-center relative">
      <div id="profile-container"></div>
      <div
        id="profile-dropdown"
        class="absolute right-0 top-10 mt-2 w-48 bg-gray-800 rounded-md shadow-lg py-1 hidden"
      >
        <a
          href="publish-tournament.html"
          class="block px-4 py-2 text-sm text-white hover:bg-gray-700"
          >Publish Tournament</a
        >
        <button
          id="logout-btn"
          class="w-full text-left px-4 py-2 text-sm text-white hover:bg-gray-700"
        >
          Logout
        </button>
      </div>
    </div>
  </header>

  <!-- Sidebar -->
  <div
    id="sidebar"
    class="fixed top-0 left-0 h-full bg-black z-40 sidebar pt-24"
  >
    <div class="flex flex-col h-full p-8 text-white">
      <ul>
        <li class="mb-2">
          <a
            href="#"
            class="text-xl font-semibold block py-2 hover:text-gray-400"
            >Contact Us</a
          >
        </li>
        <li class="mb-2">
          <a
            href="#"
            class="text-xl font-semibold block py-2 hover:text-gray-400"
            >Work With Us</a
          >
        </li>
        <li class="mb-2">
          <button
            id="socials-toggle"
            class="text-xl font-semibold w-full text-left py-2 flex items-center justify-between hover:text-gray-400"
          >
            Our Socials
            <i
              class="fas fa-chevron-down text-base transition-transform duration-300"
            ></i>
          </button>
          <ul id="social-links" class="pl-4 mt-1 hidden space-y-2">
            <li>
              <a href="#" class="text-base block hover:text-gray-400"
                >Instagram</a
              >
            </li>
            <li>
              <a href="#" class="text-base block hover:text-gray-400">Discord</a>
            </li>
            <li>
              <a href="#" class="text-base block hover:text-gray-400">YouTube</a>
            </li>
            <li>
              <a href="#" class="text-base block hover:text-gray-400">X</a>
            </li>
            <li>
              <a href="#" class="text-base block hover:text-gray-400"
                >WhatsApp Channel</a
              >
            </li>
          </ul>
        </li>
      </ul>
    </div>
  </div>

  <!-- Main -->
  <main class="container mx-auto p-4 pt-24">
    <div
      class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4"
    >
      <h1 class="text-2xl text-red-600 font-bold mb-2 sm:mb-0">Tournaments</h1>
      <a
        href="publish-tournament.html"
        class="px-4 py-2 text-sm text-red-600 border-2 border-red-600 rounded-full hover:bg-red-600 hover:text-white transition-colors duration-300"
      >
        Publish Tournament
      </a>
    </div>

    <!-- Filter -->
    <div class="mb-6">
      <label
        for="game-filter"
        class="block text-sm font-medium text-gray-400 mb-1"
        >Filter by Game:</label
      >
      <select
        id="game-filter"
        class="w-full sm:w-1/2 md:w-1/3 p-2 rounded-lg border-2 border-red-600 bg-gray-900 text-white focus:ring-red-600 focus:border-red-600"
      ></select>
    </div>

    <div
      id="tournaments-container"
      class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"
    ></div>
  </main>

  <!-- Footer -->
  <footer class="mt-auto py-4">
    <hr class="border-t border-gray-700 mx-auto w-full my-4" />
    <div
      class="container mx-auto text-center text-gray-400 flex flex-col items-center"
    >
      <div class="flex flex-wrap justify-center space-x-4 mb-2 text-xs">
        <a href="pages/privacy-policy.html" class="hover:text-white"
          >Privacy Policy</a
        >
        <a href="pages/terms-of-use.html" class="hover:text-white"
          >Terms Of Use</a
        >
        <a href="pages/cookie-policy.html" class="hover:text-white"
          >Cookie Policy</a
        >
        <a href="pages/faq.html" class="hover:text-white">FAQ</a>
      </div>
      <div class="flex justify-center space-x-4 text-base mb-2">
        <a href="https://www.instagram.com" class="hover:text-white"
          ><i class="fab fa-instagram"></i
        ></a>
        <a href="https://discord.com" class="hover:text-white"
          ><i class="fab fa-discord"></i
        ></a>
        <a href="https://www.youtube.com" class="hover:text-white"
          ><i class="fab fa-youtube"></i
        ></a>
        <a href="https://x.com" class="hover:text-white"
          ><i class="fab fa-x-twitter"></i
        ></a>
      </div>
      <p class="text-xs">&copy; 2025 Esportive. All rights reserved.</p>
      <div class="flex justify-center items-center py-4 space-x-4">
        <img src="../assets/navbar/logo.png" alt="Esportive Logo" class="h-6" />
        <span class="text-gray-500 font-bold text-sm">PART OF</span>
        <img src="../assets/footer/flm.png" alt="FLM Logo" class="h-6" />
      </div>
    </div>
  </footer>

  <!-- JS Logic -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
    import { getAuth, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-auth.js";

    const googleSheetsUrl =
      "https://docs.google.com/spreadsheets/d/14vc1xeqDs5fGoIqasCEN9J4UDMFV6Qx6wGQTo-3rXnc/export?format=csv&gid=0";

    const firebaseConfig = {
      apiKey: "AIzaSyDB9gtUd2KcBB9bEkD8Jzj_kyFE20GE7OA",
      authDomain: "espotive.firebaseapp.com",
      projectId: "espotive",
      storageBucket: "espotive.appspot.com",
      messagingSenderId: "439864037476",
      appId: "1:439864037476:web:f6dc91eefae15c00a3cf71",
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    const detailsIcons = {
  "Event Name": `<div class="inline w-6 h-6 mr-2 p-1 rounded-lg bg-white/20 backdrop-blur-md flex items-center justify-center">
    <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-yellow-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <!-- Trophy icon -->
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 21h6M12 17v4m-3-4a4 4 0 01-4-4V7h14v6a4 4 0 01-4 4"/>
    </svg>
  </div>`,

  Game: `<div class="inline w-6 h-6 mr-2 p-1 rounded-lg bg-white/20 backdrop-blur-md flex items-center justify-center">
    <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-green-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <!-- Game controller -->
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 12v.01M10 12v.01M14 12v.01M18 12v.01M12 14v.01M5 8h14a2 2 0 012 2v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4a2 2 0 012-2z"/>
    </svg>
  </div>`,

  PrizePool: `<div class="inline w-6 h-6 mr-2 p-1 rounded-lg bg-white/20 backdrop-blur-md flex items-center justify-center">
    <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-cyan-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <!-- Coin / money -->
      <circle cx="12" cy="12" r="9" stroke-width="2"/>
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v8m-4-4h8"/>
    </svg>
  </div>`,

  Slots: `<div class="inline w-6 h-6 mr-2 p-1 rounded-lg bg-white/20 backdrop-blur-md flex items-center justify-center">
    <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-purple-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <!-- Player slot / avatar icon -->
      <circle cx="12" cy="8" r="3"/>
      <path d="M5 20c0-3.333 5-5 7-5s7 1.667 7 5"/>
    </svg>
  </div>`,

  Format: `<div class="inline w-6 h-6 mr-2 p-1 rounded-lg bg-white/20 backdrop-blur-md flex items-center justify-center">
    <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-blue-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <!-- Bracket / tournament icon -->
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 18h16M12 6v12"/>
    </svg>
  </div>`,

  "Close Date": `<div class="inline w-6 h-6 mr-2 p-1 rounded-lg bg-white/20 backdrop-blur-md flex items-center justify-center">
    <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-pink-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <!-- Calendar with clock -->
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3M16 7V3M3 11h18M5 21h14a2 2 0 002-2V7H3v12a2 2 0 002 2z"/>
    </svg>
  </div>`,

  Organization: `<div class="inline w-6 h-6 mr-2 p-1 rounded-lg bg-white/20 backdrop-blur-md flex items-center justify-center">
    <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-orange-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <!-- Team / organization -->
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 2l3 7h7l-5.5 4 2 7-6-4-6 4 2-7-5.5-4h7z"/>
    </svg>
  </div>`,

  "Social Link": `<div class="inline w-6 h-6 mr-2 p-1 rounded-lg bg-white/20 backdrop-blur-md flex items-center justify-center">
    <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-red-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <!-- Share / link icon -->
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 8l5 5-5 5M10 12h10"/>
    </svg>
  </div>`,
};

    const detailRow = (label, value, link = false) => `
      <li class="flex items-start py-2 border-b border-gray-700 last:border-0">
        ${detailsIcons[label] || ""}
        <span class="font-semibold text-white min-w-[120px]">${label}:</span>
        <span class="ml-2 text-gray-300 ${link ? 'text-blue-400 underline' : ''}">
          ${link ? `<a href="${value}" target="_blank" rel="noopener">View</a>` : value || "—"}
        </span>
      </li>`;

    // ✅ Auth check
    onAuthStateChanged(auth, (user) => {
      const profileContainer = document.getElementById("profile-container");
      const profileDropdown = document.getElementById("profile-dropdown");

      if (user) {
        profileContainer.innerHTML = user.photoURL
          ? `<img src="${user.photoURL}" alt="User" class="h-8 w-8 rounded-full border-2 border-red-600 cursor-pointer">`
          : `<i class="fas fa-user-circle text-2xl text-white cursor-pointer"></i>`;

        profileContainer.addEventListener("click", () => {
          profileDropdown.classList.toggle("hidden");
        });
      } else {
        window.location.href = "index.html";
      }
    });

    document.addEventListener("DOMContentLoaded", () => {
      const logoutButton = document.getElementById("logout-btn");
      if (logoutButton) {
        logoutButton.addEventListener("click", async () => {
          try {
            await signOut(auth);
            window.location.href = "index.html";
          } catch (err) {
            console.error(err);
          }
        });
      }

      const menuToggle = document.getElementById("menu-toggle");
      const menuIcon = document.getElementById("menu-icon");
      const sidebar = document.getElementById("sidebar");
      const socialsToggle = document.getElementById("socials-toggle");
      const socialLinks = document.getElementById("social-links");

      // Sidebar toggle
      menuToggle.addEventListener("click", () => {
        sidebar.classList.toggle("open");
        if (sidebar.classList.contains("open")) {
          menuIcon.classList.remove("fa-bars");
          menuIcon.classList.add("fa-xmark");
        } else {
          menuIcon.classList.remove("fa-xmark");
          menuIcon.classList.add("fa-bars");
        }
      });

      // Auto-close sidebar when clicking outside
      document.addEventListener("click", (e) => {
        if (
          sidebar.classList.contains("open") &&
          !sidebar.contains(e.target) &&
          !menuToggle.contains(e.target)
        ) {
          sidebar.classList.remove("open");
          menuIcon.classList.remove("fa-xmark");
          menuIcon.classList.add("fa-bars");
        }
      });

      // Social links toggle
      socialsToggle.addEventListener("click", () => {
        socialLinks.classList.toggle("hidden");
        socialsToggle.querySelector("i").classList.toggle("rotate-180");
      });

      const tournamentsContainer = document.getElementById("tournaments-container");
      const gameFilter = document.getElementById("game-filter");
      let allTournaments = [];

      const parseCSV = (csv) => {
        const lines = csv.split("\n").filter((l) => l.trim() !== "");
        const headers = lines[0].split(",").map((h) => h.trim());
        return lines.slice(1).map((line) => {
          const values = line.split(",").map((v) => v.trim());
          const row = {};
          headers.forEach((h, i) => (row[h] = values[i]));
          return row;
        });
      };

      const createCard = (t) => {
        const closeDate = new Date(t["Close Date"]);
        const now = new Date();
        const timeDiff = closeDate - now;
        const isExpired = timeDiff <= 0;
        let countdownText = "Registration Closed";
        if (!isExpired) {
          const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
          const hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
          countdownText = `${days}d ${hours}h left`;
        }

        const card = document.createElement("div");
        card.className =
          "bg-gray-800/50 backdrop-blur-sm rounded-xl overflow-hidden shadow-lg hover:shadow-red-600/30 hover:scale-[1.02] transition-all duration-300 flex flex-col relative group tournament-card border border-gray-700";

        card.innerHTML = `
          <div class="relative w-full h-48 bg-black">
            <img src="${t.ImageURL || "../assets/navbar/logo.png"}" alt="${t["Event Name"]}" class="h-full w-full object-cover" />
            <span class="absolute top-2 left-2 bg-red-600 text-xs px-2 py-1 rounded-full font-semibold">${t.Game}</span>
            <span class="absolute top-2 right-2 bg-gray-800 text-xs px-2 py-1 rounded-full">${t.Slots} slots</span>
          </div>
          <div class="p-4 flex-1 flex flex-col">
            <h2 class="text-lg font-bold text-white truncate mb-1" title="${t["Event Name"]}">${t["Event Name"]}</h2>
            <p class="text-sm text-gray-400 mb-2">By ${t.Organization}</p>
            <div class="flex items-center justify-between text-sm text-gray-300 mb-3">
              <span class="font-semibold text-green-400">${t.PrizePool}</span>
              <span class="text-xs ${isExpired ? 'text-red-400' : 'text-yellow-400'}">${countdownText}</span>
            </div>
            <div class="mt-auto flex space-x-2">
              <button class="flex-1 px-3 py-2 text-sm text-white border-2 border-red-600 rounded-lg hover:bg-red-600 transition-colors" data-details-toggle>Details</button>
              <a href="${t.Registration}" target="_blank"
                 class="flex-1 px-3 py-2 text-sm text-center text-white bg-red-600 rounded-lg hover:bg-red-700 transition-colors">
                 Register
              </a>
            </div>

            <!-- Enhanced Details Dropdown -->
            <div class="mt-4 hidden" data-card-details>
              <div class="bg-gray-900/90 backdrop-blur-md rounded-lg p-4 border border-gray-700">
                <div class="flex justify-between items-start mb-3">
                  <h3 class="text-red-500 font-bold">Tournament Info</h3>
                  <button class="text-gray-400 hover:text-white text-sm" data-details-close>&times;</button>
                </div>
                <ul class="space-y-2 text-sm mb-4">
                  ${detailRow("Event Name", t["Event Name"])}
                  ${detailRow("Game", t.Game)}
                  ${detailRow("PrizePool", t.PrizePool)}
                  ${detailRow("Slots", t.Slots)}
                  ${detailRow("Format", t.Format)}
                  ${detailRow("Close Date", t["Close Date"])}
                  ${detailRow("Organization", t.Organization)}
                  ${detailRow("Social Link", t["Social Link"], true)}
                </ul>

                <!-- Social Share -->
<div class="mb-3">
  <p class="text-xs text-gray-400 mb-1">Share this tournament:</p>
  <div class="flex space-x-2">
    <!-- WhatsApp -->
    <a 
      href="https://api.whatsapp.com/send?text=${encodeURIComponent(`Join ${t['Event Name']} on Esportive! ${window.location.href}`)}" 
      target="_blank" 
      class="text-xs bg-white/20 backdrop-blur-md hover:bg-white/30 px-3 py-1 rounded-lg flex items-center transition duration-200"
    >
      <i class="fab fa-whatsapp text-green-500 mr-1"></i> WhatsApp
    </a>

    <!-- Discord -->
    <a 
      href="https://discord.com/channels/@me" 
      target="_blank" 
      class="text-xs bg-white/20 backdrop-blur-md hover:bg-white/30 px-3 py-1 rounded-lg flex items-center transition duration-200"
    >
      <i class="fab fa-discord text-indigo-500 mr-1"></i> Discord
    </a>

    <!-- Instagram -->
    <a 
      href="https://www.instagram.com/" 
      target="_blank" 
      class="text-xs bg-white/20 backdrop-blur-md hover:bg-white/30 px-3 py-1 rounded-lg flex items-center transition duration-200"
    >
      <i class="fab fa-instagram text-pink-500 mr-1"></i> Instagram
    </a>

    <!-- X / Twitter -->
    <a 
      href="https://twitter.com/intent/tweet?text=${encodeURIComponent(`Join ${t['Event Name']} on Esportive!`)}&url=${encodeURIComponent(window.location.href)}" 
      target="_blank" 
      class="text-xs bg-white/20 backdrop-blur-md hover:bg-white/30 px-3 py-1 rounded-lg flex items-center transition duration-200"
    >
      <i class="fa-brands fa-x text-blue-500 mr-1"></i> X
    </a>
  </div>
</div>

                <!-- Countdown -->
                <div class="text-center text-xs text-gray-400">
                  ${isExpired ? "❌ Registration closed" : `⏳ Closes in: ${countdownText}`}
                </div>
              </div>
            </div>
          </div>
        `;
        return card;
      };

      const renderTournaments = (tournaments) => {
        tournamentsContainer.innerHTML = "";
        if (tournaments.length === 0) {
          tournamentsContainer.innerHTML =
            '<p class="text-center text-gray-500">No tournaments found.</p>';
          return;
        }
        tournaments.forEach((t) => {
          const card = createCard(t);
          tournamentsContainer.appendChild(card);
        });

        // Attach event listeners for details toggle
        document.querySelectorAll("[data-details-toggle]").forEach((btn) => {
          btn.addEventListener("click", () => {
            const details = btn.closest(".tournament-card").querySelector("[data-card-details]");
            details.classList.remove("hidden");
            btn.classList.add("hidden");
          });
        });

        document.querySelectorAll("[data-details-close]").forEach((btn) => {
          btn.addEventListener("click", () => {
            const card = btn.closest(".tournament-card");
            const details = card.querySelector("[data-card-details]");
            const toggleBtn = card.querySelector("[data-details-toggle]");
            details.classList.add("hidden");
            toggleBtn.classList.remove("hidden");
          });
        });
      };

      const createFilterDropdown = () => {
        const games = [
          "BGMI",
          "Free Fire",
          "CODM",
          "Clash Of Clans",
          "Clash Royale",
          "Brawl Stars",
          "Pokemon Unite",
        ];
        gameFilter.innerHTML = '<option value="">All Games</option>';
        games.forEach((g) => {
          const option = document.createElement("option");
          option.value = g;
          option.textContent = g;
          gameFilter.appendChild(option);
        });
      };

      const fetchTournaments = async () => {
        try {
          const response = await fetch(googleSheetsUrl);
          const csvText = await response.text();
          allTournaments = parseCSV(csvText);

          createFilterDropdown();
          renderTournaments(allTournaments.slice(0, 10));

          gameFilter.addEventListener("change", (e) => {
            const gameToFilter = e.target.value;
            let filtered = allTournaments;
            if (gameToFilter) {
              filtered = allTournaments.filter((t) => t["Game"] === gameToFilter);
            }
            renderTournaments(filtered.slice(0, 10));
 });
        } catch (error) {
          console.error("Error fetching tournaments:", error);
        }
      };

      fetchTournaments();
    });
  </script>
</body>
</html>
