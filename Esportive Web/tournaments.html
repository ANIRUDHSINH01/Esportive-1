<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Esportive Tournaments</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Zalando+Sans+Expanded:wght@700;900&display=swap" rel="stylesheet">
  <style>
    body {
      background: url('https://media.giphy.com/media/pHEiu1rj2Rk2k/giphy.gif') center center fixed no-repeat;
      background-size: cover;
      color: #eee;
      font-family: 'Zalando Sans Expanded', sans-serif;
      margin: 0;
      min-height: 100vh;
    }
    body::before {
      content: "";
      position: fixed; inset: 0;
      z-index: -1;
      background: rgba(0,0,0,0.78);
      backdrop-filter: blur(10px);
    }
    header {
      display: flex; align-items: center; justify-content: space-between;
      padding: 1rem 2rem; position: fixed; top: 0; left: 0; right: 0;
      background: rgba(255,255,255,0.08); z-index: 1000;
      border-bottom: 1px solid rgba(255,59,59,0.18);
      border-radius: 0 0 22px 22px;
    }
    .logo-wrap { flex:1; display: flex; justify-content: center; }
    header img.logo { height: 44px; filter: drop-shadow(0 0 6px #ff3b3b) }
    #profile-container { min-width:32px; min-height:32px; border-radius:9999px; border:2px solid #ff3b3b; display:inline-flex; align-items:center; justify-content:center; overflow:hidden; background:#202018;}
    #profile-container img { width:32px; height:32px }
    #profile-container i { color:#fff; font-size:28px; }
    #profile-dropdown {
      display:none; position:absolute; right:10px; top:54px; min-width:150px; border-radius:12px;
      background:rgba(23,23,24,0.97); border:1px solid #ff3b3b33; z-index:1200; box-shadow:0 4px 16px #2d161633;
    }
    #profile-dropdown.show { display:block }
    #profile-dropdown a, #profile-dropdown button { display:block;padding:11px 17px;background:none;border:none;color:#fff;text-align:left;font-size:15px;width:100%;cursor:pointer;}
    #profile-dropdown a:hover,#profile-dropdown button:hover { background:#ff3b3b;color:#fff }
    main { max-width:1100px; margin: 0 auto; padding:5.5rem 1.2rem 3rem }
    h1 { text-align: center; color: #ff3b3b; font-weight: 900; font-size: 2.2rem; margin-bottom: 2.2rem; letter-spacing:.08em; text-shadow: 0 1px 7px #ff3b3b40; }
    select#game-filter { margin: 0 auto 1.5rem auto; display: block; max-width:290px; width:100%; background:rgba(255,255,255,0.09); border:2px solid #ff3b3b;font-weight:800; border-radius:8px; padding:0.7rem 0.99rem; color:#ff3b3b; font-size:1.05rem;}
    #tournaments-container { display:flex; gap:1.35rem; overflow-x:auto; padding-bottom:1rem; scroll-padding-left:1rem; }
    @media(max-width: 700px) { #tournaments-container { flex-direction:column; } main { padding-top:5rem; } }
    .tournament-card {
      min-width:270px; background:rgba(255,255,255,0.11); border-radius:17px; border:1.4px solid #ff3b3b35;
      backdrop-filter:blur(14px); color:#fff; box-shadow:0 2px 16px #ff3b3b44; user-select: text;
      padding:1.3rem 1rem 1.7rem 1rem; transition:box-shadow 0.3s, border-color 0.3s; display:flex; flex-direction:column;align-items:center
    }
    .tournament-card:hover { box-shadow:0 6px 24px #ff3b3b66; border-color:#ff3b3b; transform:scale(1.03);}
    .tournament-card img { width:95%;max-height:120px;object-fit:contain; border-radius:11px; margin-bottom:.7rem; background:#212;}
    .tournament-card h2 { color:#ff3b3b; font-size:1.23rem;margin:0.2rem 0;}
    .tournament-card p { color:#ddd;margin:.2rem 0;}
    .buttons-row { display:flex;gap:1rem;margin-top:.7rem }
    .button-neon { background: rgba(255,59,59,0.22); border:2px solid #ff3b3b; color: white; font-weight: 700; border-radius:9999px; padding:0.47rem 1.55rem; font-size:1.08rem; cursor:pointer; transition:.2s box-shadow, .2s background; box-shadow:0 0 8px #ff3b3b33 }
    .button-neon:hover, .button-neon:focus { background:#ff3b3b; box-shadow:0 0 14px #ff3b3b77 }
    .modal-overlay { position:fixed;inset:0;z-index:4000; background:rgba(0,0,0,0.7);backdrop-filter:blur(12px); display:none;align-items:center;justify-content:center;}
    .modal-overlay.active { display:flex; }
    .modal-content { background:rgba(18,18,20,0.98); border-radius:17px; max-width:390px;width:92vw; max-height:78vh; padding:1.4rem 1.6rem 1.1rem 1.6rem; box-shadow:0 0 20px #ff3b3b77; position:relative;color:#fff;overflow:auto; font-size:1.06rem;}
    .modal-close {position:absolute;top:9px;right:13px; font-size:2rem;color:#ff3b3b;background:none;border:none;cursor:pointer;}
    ul.detail-list {margin:0;padding:0;list-style:none;}
    ul.detail-list li {display:flex;align-items:center;gap:0.7rem;padding:0.43rem 0;border-bottom:1px solid #ff3b3b28}
    .details-label {font-weight:700;min-width:100px;color:#ff3b3b;}
    svg.details-icon {width:21px;height:21px;flex-shrink:0;filter:drop-shadow(0 0 7px #f34);}
  </style>
</head>
<body>
  <header>
    <div></div>
    <div class="logo-wrap">
      <img src="../assets/navbar/logo.png" class="logo" alt="Logo">
    </div>
    <div style="position:relative">
      <div id="profile-container"></div>
      <div id="profile-dropdown">
        <a href="publish-tournament.html">Publish Tournament</a>
        <button id="logout-btn">Logout</button>
      </div>
    </div>
  </header>
  <main>
    <h1>Featured Tournaments</h1>
    <select id="game-filter"></select>
    <div id="tournaments-container"></div>
  </main>
  <!-- Modal -->
  <div id="details-modal" class="modal-overlay">
    <div class="modal-content">
      <button id="close-modal-btn" class="modal-close" aria-label="Close">&times;</button>
      <h2 id="modal-title"></h2>
      <ul id="modal-details-list" class="detail-list"></ul>
    </div>
  </div>
  <!-- Firebase CDN -->
  <script src="https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/12.3.0/firebase-auth.js"></script>
  <!-- Font Awesome Icons -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/js/all.min.js"></script>
  <script>
    // Firebase config using only globals (NO import/export)
    var firebaseConfig = {
      apiKey: "AIzaSyDB9gtUd2KcBB9bEkD8Jzj_kyFE20GE7OA",
      authDomain: "espotive.firebaseapp.com",
      projectId: "espotive",
      storageBucket: "espotive.firebasestorage.app",
      messagingSenderId: "439864037476",
      appId: "1:439864037476:web:f6dc91eefae15c00a3cf71",
      measurementId: "G-Q2W9WHLCCR"
    };
    firebase.initializeApp(firebaseConfig);
    var auth = firebase.auth();

    // Profile login/logout UI
    document.addEventListener("DOMContentLoaded", function(){
      var profileContainer = document.getElementById("profile-container");
      var profileDropdown = document.getElementById("profile-dropdown");
      auth.onAuthStateChanged(function(user){
        if(user){
          if(user.photoURL){
            profileContainer.innerHTML = `<img src="${user.photoURL}" alt="Profile">`;
          }else{
            profileContainer.innerHTML = `<i class="fas fa-user-circle"></i>`;
          }
          profileContainer.onclick = function(){ profileDropdown.classList.toggle('show'); };
        }else{
          window.location.href = "index.html";
        }
      });
      document.getElementById('logout-btn').onclick = function(){
        auth.signOut().then(function(){ window.location.href="index.html"; });
      };
      var modal = document.getElementById("details-modal");
      var closeModalBtn = document.getElementById("close-modal-btn");
      closeModalBtn.onclick = function(){ modal.classList.remove("active"); document.body.style.overflow = ""; };
      modal.onclick = function(e){ if(e.target===modal){ modal.classList.remove("active"); document.body.style.overflow = ""; } };
      window.addEventListener("keydown", function(e){ if(e.key==="Escape" && modal.classList.contains("active")){ closeModalBtn.click(); }});
    });
    // Details icon utility
    function detailsIcon(label){
      var icons={
        "Event Name":`<svg xmlns="http://www.w3.org/2000/svg" class="details-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7 12l5 5"/></svg>`,
        "Game":`<svg xmlns="http://www.w3.org/2000/svg" class="details-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path d="M12 6v6l4 2"/></svg>`,
        "PrizePool":`<svg xmlns="http://www.w3.org/2000/svg" class="details-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor"><circle cx="12" cy="12" r="10" /></svg>`,
        "Slots":`<svg xmlns="http://www.w3.org/2000/svg" class="details-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor"><rect x="5" y="7" width="14" height="10" rx="2"/></svg>`,
        "Format":`<svg xmlns="http://www.w3.org/2000/svg" class="details-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path d="M3 10h18M3 14h18"/></svg>`,
        "Close Date":`<svg xmlns="http://www.w3.org/2000/svg" class="details-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3M16 7V3M3 11h18M5 21h14a2 2 0 002-2V7H3v12a2 2 0 002 2z"/></svg>`,
        "Organization":`<svg xmlns="http://www.w3.org/2000/svg" class="details-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v3a4 4 0 004 4h10"/></svg>`,
        "Social Link":`<svg xmlns="http://www.w3.org/2000/svg" class="details-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path d="M15 7a2 2 0 00-2 2m0 0v4a2 2 0 002 2m-4-6a2 2 0 00-2 2m0 0v4a2 2 0 002 2m-6-4h.01"/></svg>`
      };
      return icons[label]||"";
    }
    function parseCSV(csvText){
      var lines = csvText.trim().split("\n");
      var headers = lines.shift().split(",").map(h=>h.trim());
      return lines.map(function(line){
        var values = line.split(",").map(v=>v.trim());
        var obj = {};
        headers.forEach(function(h,i){ obj[h]=values[i]; });
        return obj;
      });
    }
    function showDetailsModal(tournament){
      var modal = document.getElementById("details-modal");
      document.getElementById("modal-title").textContent = tournament["Event Name"];
      var list = document.getElementById("modal-details-list");
      list.innerHTML = "";
      var fields=["Event Name","Game","PrizePool","Slots","Format","Close Date","Organization","Social Link"];
      fields.forEach(function(field){
        var isLink = field==="Social Link";
        var value=tournament[field]||"";
        var icon=detailsIcon(field);
        var html = `<li>${icon}<span class="details-label">${field}:</span> ${
          isLink ? `<a href="${value}" target="_blank" rel="noopener">${value}</a>` : value
        }</li>`;
        list.innerHTML += html;
      });
      modal.classList.add("active");
      document.body.style.overflow = "hidden";
      document.getElementById("close-modal-btn").focus();
    }
    function renderTournaments(tournaments){
      var container=document.getElementById('tournaments-container');
      container.innerHTML="";
      if(!tournaments.length){
        container.innerHTML='<p style="color:#aaa;text-align:center">No tournaments found.</p>'; return;
      }
      tournaments.forEach(function(t){
        var card=document.createElement('div');
        card.className="tournament-card";
        card.innerHTML=
          `<img src="${t.ImageURL}" alt="${t['Event Name']}">
           <h2>${t['Event Name']}</h2>
           <p>Game: ${t.Game}</p>
           <p style="font-size:0.97rem">Prize Pool: ${t.PrizePool}</p>
           <div class="buttons-row">
             <button class="button-neon details-btn">Details</button>
             <a href="${t.Registration}" target="_blank" class="button-neon">Register</a>
           </div>`;
        card.querySelector('.details-btn').onclick=function(){ showDetailsModal(t); };
        container.appendChild(card);
      });
    }
    function setupFilter(allTournaments){
      var select=document.getElementById('game-filter');
      var games=[...new Set(allTournaments.map(x=>x.Game))].sort();
      select.innerHTML='<option value="">All Games</option>'+games.map(g=>`<option value="${g}">${g}</option>`).join('');
      select.onchange=function(){
        var filtered=select.value?allTournaments.filter(t=>t.Game===select.value):allTournaments;
        renderTournaments(filtered);
      };
    }
    // Fetch and render tournaments on load
    document.addEventListener("DOMContentLoaded",function(){
      fetch("https://docs.google.com/spreadsheets/d/14vc1xeqDs5fGoIqasCEN9J4UDMFV6Qx6wGQTo-3rXnc/export?format=csv&gid=0")
        .then(function(r){return r.text();})
        .then(function(text){
          var tournaments = parseCSV(text);
          setupFilter(tournaments);
          renderTournaments(tournaments);
        })
        .catch(function(){ document.getElementById('tournaments-container').innerHTML='<p style="color:red;text-align:center">Failed to load tournaments.</p>'; });
    });
  </script>
</body>
</html>
