<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tournaments | Esportive</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Zalando+Sans+Expanded:ital,wght@0,200..900;1,200..900&display=swap"
    rel="stylesheet"
  />
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
  />
  <style>
  body {
    font-family: "Zalando Sans Expanded", sans-serif;
  }

  /* Sidebar hidden by default */
  #sidebar {
    transform: translateX(-100%);
    transition: transform 0.3s ease-in-out;
    width: 75%; /* mobile width */
    max-width: 300px;
  }

  /* When open */
  #sidebar.open {
    transform: translateX(0);
  }
  </style>
</head>
<body class="flex flex-col min-h-screen">
  <!-- Header -->
  <header
    class="fixed top-0 left-0 right-0 z-50 bg-black text-white px-4 py-6 lg:py-8 flex items-center justify-between"
  >
    <div class="flex items-center">
      <button id="menu-toggle" class="text-xl text-white focus:outline-none">
        <i id="menu-icon" class="fas fa-bars transition-transform duration-300"></i>
      </button>
    </div>
    <div class="flex-grow flex justify-center">
      <img
        src="../assets/navbar/logo.png"
        alt="Esportive Logo"
        class="h-8 lg:h-10"
      />
    </div>
    <div class="flex items-center relative">
      <div id="profile-container"></div>
      <div
        id="profile-dropdown"
        class="absolute right-0 top-10 mt-2 w-48 bg-gray-800 rounded-md shadow-lg py-1 hidden"
      >
        <a
          href="publish-tournament.html"
          class="block px-4 py-2 text-sm text-white hover:bg-gray-700"
          >Publish Tournament</a
        >
        <button
          id="logout-btn"
          class="w-full text-left px-4 py-2 text-sm text-white hover:bg-gray-700"
        >
          Logout
        </button>
      </div>
    </div>
  </header>

  <!-- Sidebar -->
  <div
    id="sidebar"
    class="fixed top-0 left-0 h-full bg-black z-40 sidebar pt-24"
  >
    <div class="flex flex-col h-full p-8 text-white">
      <ul>
        <li class="mb-2">
          <a
            href="#"
            class="text-xl font-semibold block py-2 hover:text-gray-400"
            >Contact Us</a
          >
        </li>
        <li class="mb-2">
          <a
            href="#"
            class="text-xl font-semibold block py-2 hover:text-gray-400"
            >Work With Us</a
          >
        </li>
        <li class="mb-2">
          <button
            id="socials-toggle"
            class="text-xl font-semibold w-full text-left py-2 flex items-center justify-between hover:text-gray-400"
          >
            Our Socials
            <i
              class="fas fa-chevron-down text-base transition-transform duration-300"
            ></i>
          </button>
          <ul id="social-links" class="pl-4 mt-1 hidden space-y-2">
            <li>
              <a href="#" class="text-base block hover:text-gray-400"
                >Instagram</a
              >
            </li>
            <li>
              <a href="#" class="text-base block hover:text-gray-400">Discord</a>
            </li>
            <li>
              <a href="#" class="text-base block hover:text-gray-400">YouTube</a>
            </li>
            <li>
              <a href="#" class="text-base block hover:text-gray-400">X</a>
            </li>
            <li>
              <a href="#" class="text-base block hover:text-gray-400"
                >WhatsApp Channel</a
              >
            </li>
          </ul>
        </li>
      </ul>
    </div>
  </div>

  <!-- Main -->
  <main class="container mx-auto p-4 pt-24">
    <div
      class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4"
    >
      <h1 class="text-2xl font-bold mb-2 sm:mb-0">Tournaments</h1>
      <a
        href="publish-tournament.html"
        class="px-4 py-2 text-sm text-white border-2 border-red-600 rounded-full hover:bg-red-600 transition-colors duration-300"
      >
        Publish Tournament
      </a>
    </div>

    <!-- Filter -->
    <div class="mb-6">
      <label
        for="game-filter"
        class="block text-sm font-medium text-gray-400 mb-1"
        >Filter by Game:</label
      >
      <select
        id="game-filter"
        class="w-full sm:w-1/2 md:w-1/3 p-2 rounded-lg border-2 border-red-600 bg-gray-900 text-white focus:ring-red-600 focus:border-red-600"
      ></select>
    </div>

    <div
      id="tournaments-container"
      class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"
    ></div>
  </main>

  <!-- Footer -->
  <footer class="mt-auto py-4">
    <hr class="border-t border-gray-700 mx-auto w-full my-4" />
    <div
      class="container mx-auto text-center text-gray-400 flex flex-col items-center"
    >
      <div class="flex flex-wrap justify-center space-x-4 mb-2 text-xs">
        <a href="pages/privacy-policy.html" class="hover:text-white"
          >Privacy Policy</a
        >
        <a href="pages/terms-of-use.html" class="hover:text-white"
          >Terms Of Use</a
        >
        <a href="pages/cookie-policy.html" class="hover:text-white"
          >Cookie Policy</a
        >
        <a href="pages/faq.html" class="hover:text-white">FAQ</a>
      </div>
      <div class="flex justify-center space-x-4 text-base mb-2">
        <a href="https://www.instagram.com" class="hover:text-white"
          ><i class="fab fa-instagram"></i
        ></a>
        <a href="https://www.discord.com" class="hover:text-white"
          ><i class="fab fa-discord"></i
        ></a>
        <a href="https://www.youtube.com" class="hover:text-white"
          ><i class="fab fa-youtube"></i
        ></a>
        <a href="https://www.x.com" class="hover:text-white"
          ><i class="fab fa-x"></i
        ></a>
      </div>
      <p class="text-xs">&copy; 2025 Esportive. All rights reserved.</p>
      <div class="flex justify-center items-center py-4 space-x-4">
        <img src="../assets/navbar/logo.png" alt="Esportive Logo" class="h-6" />
        <span class="text-gray-500 font-bold text-sm">PART OF</span>
        <img src="../assets/footer/flm.png" alt="FLM Logo" class="h-6" />
      </div>
    </div>
  </footer>

  <!-- JS Logic -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
    import { getAuth, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-auth.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-analytics.js";

    const googleSheetsUrl =
      "https://docs.google.com/spreadsheets/d/14vc1xeqDs5fGoIqasCEN9J4UDMFV6Qx6wGQTo-3rXnc/export?format=csv&gid=0";

    const firebaseConfig = {
      apiKey: "AIzaSyDB9gtUd2KcBB9bEkD8Jzj_kyFE20GE7OA",
      authDomain: "espotive.firebaseapp.com",
      databaseURL:
        "https://espotive-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "espotive",
      storageBucket: "espotive.appspot.com",
      messagingSenderId: "439864037476",
      appId: "1:439864037476:web:f6dc91eefae15c00a3cf71",
      measurementId: "G-Q2W9WHLCCR",
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const analytics = getAnalytics(app);

    const detailsIcons = {
      "Event Name": `<svg xmlns="http://www.w3.org/2000/svg" class="inline w-4 h-4 mr-2 text-yellow-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m1-3a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>`,
      Game: `<svg xmlns="http://www.w3.org/2000/svg" class="inline w-4 h-4 mr-2 text-green-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6l4 2"/></svg>`,
      PrizePool: `<svg xmlns="http://www.w3.org/2000/svg" class="inline w-4 h-4 mr-2 text-cyan-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 1.567-3 3.5s1.343 3.5 3 3.5 3-1.567 3-3.5-1.343-3.5-3-3.5z"/></svg>`,
      Slots: `<svg xmlns="http://www.w3.org/2000/svg" class="inline w-4 h-4 mr-2 text-purple-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><circle cx="12" cy="12" r="3"/></svg>`,
      Format: `<svg xmlns="http://www.w3.org/2000/svg" class="inline w-4 h-4 mr-2 text-blue-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><rect x="3" y="4" width="18" height="16" rx="2"/></svg>`,
      "Close Date": `<svg xmlns="http://www.w3.org/2000/svg" class="inline w-4 h-4 mr-2 text-pink-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3M16 7V3M3 11h18M5 21h14a2 2 0 002-2V7H3v12a2 2 0 002 2z"/></svg>`,
      Organization: `<svg xmlns="http://www.w3.org/2000/svg" class="inline w-4 h-4 mr-2 text-orange-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v3a4 4 0 004 4h10a4 4 0 004-4V7"/></svg>`,
      "Social Link": `<svg xmlns="http://www.w3.org/2000/svg" class="inline w-4 h-4 mr-2 text-red-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path d="M15 7a2 2 0 00-2 2m0 0v4a2 2 0 002 2m-4-6a2 2 0 00-2 2m0 0v4a2 2 0 002 2m-6-4h.01"/></svg>`,
    };

    const detailRow = (label, value, link = false) => `
      <li class="flex items-center py-1 text-gray-300">
        ${detailsIcons[label] || ""}
        <span class="font-semibold text-white">${label}:</span>
        <span class="ml-1 ${link ? "text-blue-400 underline" : ""}">
          ${link ? `<a href="${value}" target="_blank">View</a>` : value}
        </span>
      </li>`;

    // âœ… Auth check
    onAuthStateChanged(auth, (user) => {
      const profileContainer = document.getElementById("profile-container");
      const profileDropdown = document.getElementById("profile-dropdown");

      if (user) {
        profileContainer.innerHTML = user.photoURL
          ? `<img src="${user.photoURL}" alt="User" class="h-8 w-8 rounded-full border-2 border-red-600 cursor-pointer">`
          : `<i class="fas fa-user-circle text-2xl text-white cursor-pointer"></i>`;

        profileContainer.addEventListener("click", () => {
          profileDropdown.classList.toggle("hidden");
        });
      } else {
        window.location.href = "index.html";
      }
    });

    document.addEventListener("DOMContentLoaded", () => {
      const logoutButton = document.getElementById("logout-btn");
      if (logoutButton) {
        logoutButton.addEventListener("click", async () => {
          try {
            await signOut(auth);
            window.location.href = "index.html";
          } catch (err) {
            console.error(err);
          }
        });
      }

      const menuToggle = document.getElementById("menu-toggle");
const menuIcon = document.getElementById("menu-icon");
const sidebar = document.getElementById("sidebar");
const socialsToggle = document.getElementById("socials-toggle");
const socialLinks = document.getElementById("social-links");

// Sidebar toggle
menuToggle.addEventListener("click", () => {
  sidebar.classList.toggle("open");
  if (sidebar.classList.contains("open")) {
    menuIcon.classList.remove("fa-bars");
    menuIcon.classList.add("fa-xmark");
  } else {
    menuIcon.classList.remove("fa-xmark");
    menuIcon.classList.add("fa-bars");
  }
});

// Auto-close sidebar when clicking outside (optional)
document.addEventListener("click", (e) => {
  if (
    sidebar.classList.contains("open") &&
    !sidebar.contains(e.target) &&
    !menuToggle.contains(e.target)
  ) {
    sidebar.classList.remove("open");
    menuIcon.classList.remove("fa-xmark");
    menuIcon.classList.add("fa-bars");
  }
});

// Social links toggle
socialsToggle.addEventListener("click", () => {
  socialLinks.classList.toggle("hidden");
  socialsToggle.querySelector("i").classList.toggle("rotate-180");
});
      const tournamentsContainer = document.getElementById("tournaments-container");
      const gameFilter = document.getElementById("game-filter");
      let allTournaments = [];

      const parseCSV = (csv) => {
        const lines = csv.split("\n").filter((l) => l.trim() !== "");
        const headers = lines[0].split(",").map((h) => h.trim());
        return lines.slice(1).map((line) => {
          const values = line.split(",").map((v) => v.trim());
          const row = {};
          headers.forEach((h, i) => (row[h] = values[i]));
          return row;
        });
      };

      const createCard = (t) => {
        const card = document.createElement("div");
        card.className =
          "bg-gray-900 rounded-xl overflow-hidden shadow-lg hover:shadow-red-600/40 hover:scale-[1.02] transition-all duration-300 flex flex-col relative group tournament-card";
        card.innerHTML = `
          <div class="relative w-full h-48 bg-black">
            <img src="${t.ImageURL}" alt="${t["Event Name"]}" class="h-full w-full object-cover loading-lazy group-hover:opacity-90 transition" data-card-image>
            <span class="absolute top-2 left-2 bg-red-600 text-xs px-2 py-1 rounded-full font-semibold shadow">${t.Game}</span>
            <span class="absolute top-2 right-2 bg-gray-800 text-xs px-2 py-1 rounded-full font-semibold shadow">Slots: ${t.Slots}</span>
            <div class="absolute inset-0 p-4 hidden bg-gray-950/95 backdrop-blur-md rounded-xl border border-gray-800 text-left overflow-y-auto" data-card-details>
              <p class="text-base font-bold mb-3 text-red-500 border-b border-red-600 pb-2">Tournament Details</p>
              <ul class="space-y-2 text-sm">
                ${detailRow("Event Name", t["Event Name"])}
                ${detailRow("Game", t.Game)}
                ${detailRow("PrizePool", t.PrizePool)}
                ${detailRow("Slots", t.Slots)}
                ${detailRow("Format", t.Format)}
                ${detailRow("Close Date", t["Close Date"])}
                ${detailRow("Organization", t.Organization)}
                ${detailRow("Social Link", t["Social Link"], true)}
              </ul>
            </div>
          </div>
          <div class="p-4 flex-1 flex flex-col">
            <h2 class="text-lg font-bold text-white truncate mb-1" title="${t["Event Name"]}">${t["Event Name"]}</h2>
            <p class="text-sm text-gray-400 mb-2">By ${t.Organization}</p>
            <div class="flex items-center justify-between text-sm text-gray-300 mb-3">
              <span class="font-semibold text-green-400">ðŸ’° ${t.PrizePool}</span>
              <span class="text-xs text-gray-400">Closes: ${t["Close Date"]}</span>
            </div>
            <div class="mt-auto flex space-x-2">
              <button class="flex-1 px-3 py-2 text-sm text-white border-2 border-red-600 rounded-lg hover:bg-red-600 transition-colors" data-details-toggle>Details</button>
              <a href="${t.Registration}" target="_blank"
                 class="flex-1 px-3 py-2 text-sm text-center text-white bg-red-600 rounded-lg hover:bg-red-700 transition-colors">
                 Register
              </a>
            </div>
          </div>
        `;
        return card;
      };

      const renderTournaments = (tournaments) => {
        tournamentsContainer.innerHTML = "";
        if (tournaments.length === 0) {
          tournamentsContainer.innerHTML =
            '<p class="text-center text-gray-500">No tournaments found.</p>';
          return;
        }
        tournaments.forEach((t) => {
          const card = createCard(t);
          tournamentsContainer.appendChild(card);
        });
        document
          .querySelectorAll("[data-details-toggle]")
          .forEach((button) => {
            button.addEventListener("click", () => {
              const card = button.closest(".tournament-card");
              const image = card.querySelector("[data-card-image]");
              const details = card.querySelector("[data-card-details]");
              image.classList.toggle("hidden");
              details.classList.toggle("hidden");
              button.textContent = image.classList.contains("hidden")
                ? "Back"
                : "Details";
            });
          });
      };

      const createFilterDropdown = () => {
        const games = [
          "BGMI",
          "Free Fire",
          "CODM",
          "Clash Of Clans",
          "Clash Royale",
          "Brawl Stars",
          "Pokemon Unite",
        ];
        gameFilter.innerHTML = '<option value="">All Games</option>';
        games.forEach((g) => {
          const option = document.createElement("option");
          option.value = g;
          option.textContent = g;
          gameFilter.appendChild(option);
        });
      };

      const fetchTournaments = async () => {
        try {
          const response = await fetch(googleSheetsUrl);
          const csvText = await response.text();
          allTournaments = parseCSV(csvText);

          createFilterDropdown();

          renderTournaments(allTournaments.slice(0, 10));

          gameFilter.addEventListener("change", (e) => {
            const gameToFilter = e.target.value;
            let filtered = allTournaments;
            if (gameToFilter) {
              filtered = allTournaments.filter((t) => t["Game"] === gameToFilter);
            }
            renderTournaments(filtered.slice(0, 10));
          });
        } catch (error) {
          console.error("Error fetching tournaments:", error);
        }
      };

      fetchTournaments();
    });
  </script>
</body>
</html>
